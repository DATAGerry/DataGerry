<div class="modal-header">
    <h4 class="modal-title">
      <span *ngIf="isViewMode">View Impact Category</span>
      <span *ngIf="!isViewMode">
        {{ isEditMode ? (isCopyMode ? 'Copy Impact Category' : 'Edit Impact Category') : 'Add Impact Category' }}
      </span>
    </h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="onCancel()"></button>
  </div>
  
  <div class="modal-body">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <!-- Category Name -->
      <div class="mb-3">
        <label for="catName" class="form-label">
          Name <span class="text-danger">*</span>
        </label>
        <input
          id="catName"
          type="text"
          class="form-control"
          formControlName="name"
          placeholder="Enter category name..."
        />
        <div *ngIf="form.get('name')?.touched && form.get('name')?.invalid" class="invalid-feedback d-block">
          Name is required.
        </div>
      </div>
  
      <!-- Impact Descriptions -->
      <div formArrayName="impact_descriptions" class="border p-2 mb-3 bg-light">
        <div *ngFor="let row of impactDescriptions.controls; let i = index" [formGroupName]="i" class="mb-3 p-2 border">
          <!-- Read-only Impact Name -->
          <div class="fw-semibold">
            {{ row.value.impact_name }} <span class="text-danger">*</span>
          </div>
          <!-- Hidden Impact ID -->
          <input type="hidden" formControlName="impact_id" />
          <!-- Description input -->
          <div class="mt-2">
            <label for="desc_{{ i }}" class="form-label">Description for this Impact</label>
            <textarea
              id="desc_{{ i }}"
              class="form-control"
              formControlName="value"
              rows="2"
              placeholder="Enter description..."
            ></textarea>
            <div *ngIf="row.get('value')?.touched && row.get('value')?.invalid" class="invalid-feedback d-block">
              Impact description is required.
            </div>
          </div>
        </div>
      </div>
  
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="onCancel()">
          {{ isViewMode ? 'Close' : 'Cancel' }}
        </button>
        <!-- Only show the submit button if not in view mode -->
        <button type="submit" class="btn btn-primary" *ngIf="!isViewMode" [disabled]="isSubmitting || form.invalid">
          <span *ngIf="!isSubmitting">
            {{ isEditMode ? (isCopyMode ? 'Copy Impact Category' : 'Save Changes') : 'Add Impact Category' }}
          </span>
          <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm"></span>
        </button>
      </div>
    </form>
  </div>
  