<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span>Quick Vulnerabilities Import</span>
        <a class="btn btn-secondary btn-sm" routerLink="/isms/vulnerabilities">
            Go to Vulnerabilities Page
        </a>
    </div>
    <div class="card-body">

        <button class="btn btn-link" (click)="showInstructions = !showInstructions">
            {{ showInstructions ? 'Hide Instructions' : 'Show Import Instructions' }}
        </button>

        <ng-container *ngIf="showInstructions">
            <app-import-instructions
              [title]="'Importing Vulnerabilities via CSV'"
              [description]="'You can import multiple Vulnerabilities using a CSV file. Please follow the structure and guidelines below to ensure successful import.'"
              [headers]="[
                { header: 'name', type: 'string', required: 'Yes (*)', description: 'The name of the Vulnerability' },
                { header: 'source', type: 'string', required: 'No', description: 'The source of the Vulnerability' },
                { header: 'identifier', type: 'string', required: 'No', description: 'An identifier for the Vulnerability' },
                { header: 'description', type: 'string', required: 'No', description: 'A description of the Vulnerability' }
              ]"
              [mappings]="'The source value is matched against existing Sources by name. Case sensitive: &quot;Source&quot; is not equal to &quot;source&quot;. If a matching Source does not exist, it will be automatically created in the database.'"
              [duplicates]="'The system checks for existing Vulnerabilities using case-sensitive comparison across all fields. A Vulnerability is only created if there is no exact match already in the database. Re-importing the same CSV file will not result in duplicates.'"
              [exampleCsv]="'name;source;identifier;description\nVulnerability1;Source1;Identifier1;Description1\nVulnerability2;Source2;Identifier2;Description2'"
            ></app-import-instructions>
          </ng-container>
          
        <form [formGroup]="fileForm">
            <div class="form-group">
                <label for="file">Select CSV File:</label>
                <div class="custom-file">
                    <input
                        type="file"
                        class="custom-file-input"
                        id="file"
                        (change)="selectFile($event.target.files)"
                        accept=".csv"
                    />
                    <label class="custom-file-label" for="file">{{ fileName }}</label>
                </div>
            </div>
            <button
                type="button"
                class="btn btn-primary"
                [disabled]="fileForm.invalid"
                (click)="importVulnerabilities()"
            >
                Import vulnerabilies
            </button>
        </form>
    </div>
</div>

<app-loading-popup
    [isVisible]="isLoading$ | async"
    message="Importing threat objects..."
></app-loading-popup>